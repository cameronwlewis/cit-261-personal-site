{"version":3,"sources":["../../../public/javascripts/app-main.js"],"names":["accessToken","getAccessToken","xhttp","XMLHttpRequest","onreadystatechange","readyState","status","debug","responseText","debug2","open","send","window","addEventListener","load","event","removeEventListener","imageLoader","document","getElementById","handleImageUpload","canvas","ctx","getContext","selectedImage","submitImage","sendToEmotionAPI","e","reader","FileReader","onload","img","Image","width","height","drawImage","src","target","result","files","readAsDataURL","style","display","rapid","RapidAPI","strongestEmotion","call","on","payload","scores","emotionScore","key","console","log","getSpotifyPlaylist","hideCrap","showOverlay","main_container","classList","remove","className","innerHTML","_closeBtn","transition","showPlaylistSuggestion","name","artwork","url","href","spotify","SpotifyWebApi","setAccessToken","searchPlaylists","limit","err","data","error","playlist_Name","playlists","items","playlist_Artwork","images","playlist_URL","external_urls"],"mappings":"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","file":"app-main.js","sourcesContent":["let accessToken = '';\n\nfunction getAccessToken() {\n    let xhttp = new XMLHttpRequest();\n    xhttp.onreadystatechange = function() {\n        if (this.readyState === 4 && this.status === 200) {\n            let debug = this.responseText;\n            accessToken = this.responseText;\n            let debug2 = 'hi';\n        }\n    };\n    xhttp.open(\"GET\", \"http://localhost:3000/accessToken\", true);\n    xhttp.send();\n}\n\nwindow.addEventListener(\"load\", function load(event){\n    window.removeEventListener(\"load\", load, false); //remove listener, no longer needed\n    getAccessToken();\n},false);\n\n// put code here that searches playlists, and see if it works!\n\nlet imageLoader = document.getElementById('imageLoader');\nimageLoader.addEventListener('change', handleImageUpload, false);\nlet canvas = document.getElementById('uploadCanvas');\nlet ctx = canvas.getContext('2d');\n\nlet selectedImage;\nlet submitImage = document.getElementById('submit-image-button');\nsubmitImage.addEventListener('click', sendToEmotionAPI); //todo: uncomment when done debugging/testing and delete line below\n//submitImage.addEventListener('click', getSpotifyPlaylist);\n\n\nfunction handleImageUpload(e){\n    let reader = new FileReader();\n    reader.onload = function(event){\n        let img = new Image();\n        img.onload = function(){\n            canvas.width = img.width;\n            canvas.height = img.height;\n            ctx.drawImage(img,0,0);\n        };\n        img.src = event.target.result;\n        selectedImage = document.getElementById('imageLoader').files;\n    };\n    reader.readAsDataURL(e.target.files[0]);\n    document.getElementById('submit-image-button').style.display='block';\n}\n\nfunction sendToEmotionAPI(){\n    let rapid =  new RapidAPI(\"cit261-app_59643290e4b02799980f80b8\", \"cc8619fe-d5c5-47e6-9393-7f698b2c22c4\");\n    let strongestEmotion = \"\";\n    rapid.call('MicrosoftEmotionAPI', 'getEmotionRecognition', {\n        'subscriptionKey': '449155b07e884d8ea5bae531f5cf47ec',\n        'image': selectedImage[0]\n\n    }).on('success', function (payload) {\n\n        let scores = payload[0].scores;\n\n        let emotionScore = 0;\n        for (let key in scores) {\n            if (scores[key] > emotionScore) {\n                emotionScore = scores[key];\n                console.log(emotionScore);\n                strongestEmotion = key;\n                console.log(strongestEmotion);\n            }\n        }\n        // our strongest emotion from the photo has been found!\n        console.log(\"final: \" + strongestEmotion);\n        getSpotifyPlaylist(strongestEmotion)\n\n    }).on('error', function (payload) {\n\n        console.log('Error!');\n    });\n}\n\nfunction hideCrap(){\n    document.getElementById('submit-image-button').style.display = 'none';\n    document.getElementById('_content').style.display = 'none';\n}\n\nfunction showOverlay(){\n    hideCrap();\n    var main_container = document.getElementById('main_container');\n    main_container.classList.remove('page-content-container'); //todo: make sure this gets reassigned when overlay is closed\n    main_container.className += 'overlay'; //todo: make sure this get reassigned when overlay closes\n    document.getElementById('closebtn').innerHTML = 'x';\n    // 'x' close button, for mouse\n    document.getElementById('closebtn').addEventListener(\"click\", _closeBtn);\n    // for touch\n    document.getElementById('closebtn').addEventListener(\"ontouch\", _closeBtn);\n    document.getElementById('playlist-suggestion').style.transition = '0.5s';\n    document.getElementById('playlist-suggestion').style.display = 'block';\n\n\n}\n\nfunction showPlaylistSuggestion(name, artwork, url){\n    showOverlay();\n\n    document.getElementById('playlist-artwork').src = artwork;\n    document.getElementById('playlist-name').innerHTML = name;\n    document.getElementById('playlist-url').innerHTML = 'Click here to open playlist';\n    document.getElementById('playlist-url').href = url;\n}\n\nfunction getSpotifyPlaylist(strongestEmotion) {\n    let spotify = new SpotifyWebApi();\n    spotify.setAccessToken(accessToken);\n\n    spotify.searchPlaylists(strongestEmotion, {limit: 1}, function (err, data) {\n\n        if (err) console.error(err);\n        else {\n            console.log('Playlist: ', data);\n            var playlist_Name = data.playlists.items[0].name;\n            var playlist_Artwork = data.playlists.items[0].images[0].url;\n            var playlist_URL = data.playlists.items[0].external_urls.spotify;\n            console.log(playlist_Name);\n            console.log(playlist_URL);\n            hideCrap();\n            showPlaylistSuggestion(playlist_Name, playlist_Artwork, playlist_URL)\n        }\n    });\n}"]}